"use strict";(self.webpackChunkbrowser_extension_wallet=self.webpackChunkbrowser_extension_wallet||[]).push([[159],{90159:(xt,k,t)=>{t.r(k),t.d(k,{App:()=>R,default:()=>lt});var f=t(85893),U=t(64064),V=t(32387),J=t(94061),X=t(6190),$=t(28879),g=t(48161),s=t(67294),b=t(70473),q=t(86896),_=t(58533),N=t(7132),E=t(15449),tt=t(85945),et=t(98596),A=t(74301),L=t(50598),y=t(59078),nt=t(17889);const st=()=>{const{tx:r,wallet:n}=N.h.getState();return(0,s.useMemo)(()=>{var e,h;return(h=(e=r.fetchedAllChainsTransactionPeriods)==null?void 0:e[n.walletId])!=null?h:{}},[r.fetchedAllChainsTransactionPeriods,n.walletId])};var S=t(35408),ot=t(87326),F=(r,n,e)=>new Promise((h,T)=>{var d=c=>{try{l(e.next(c))}catch(o){T(o)}},v=c=>{try{l(e.throw(c))}catch(o){T(o)}},l=c=>c.done?h(c.value):Promise.resolve(c.value).then(d,v);l((e=e.apply(r,n)).next())});const m=29;function it(){const r=(0,nt.O)(),{from:n,to:e,blockchains:h,nextToken:T}=st(),d=(0,ot.R)(!0),v=(0,tt.NL)(),[l,c]=(0,s.useState)(new Date),[o,B]=(0,s.useState)((0,S.n9)(new Date,m)),[G,Z]=(0,s.useState)(!1),[K,Q]=(0,s.useState)(!1),[x,ct]=(0,s.useState)(T),[W,rt]=(0,s.useState)([]),[p,ht]=(0,s.useState)(!0),D=(0,s.useRef)(0),O=(0,s.useMemo)(()=>d.filter(i=>!W.includes(i.id)),[d,W]),ut=(0,s.useCallback)(()=>{!n||!e||!p||new Date(n)<new Date(o)&&F(this,null,function*(){yield y.Tl.emit(A.Z.FETCH_ALL_CHAINS_MISSING_TRANSACTIONS,{from:l,to:n,blockchains:O}),c(new Date(e)),B((0,S.n9)(new Date(e),m)),Z(!0)})},[n,e,l,o]),dt=(0,s.useCallback)(i=>{if(!p)return;(()=>F(this,null,function*(){yield y.Tl.emit(A.Z.FETCH_ALL_CHAINS_MISSING_TRANSACTIONS,{from:new Date(n),to:new Date(e),blockchains:i})}))()},[]),P=(i,a,u)=>{ct(u),N.h.dispatch(E.K.actions.updateAllChainsCachedTransactionsPeriod({blockchains:O.map(w=>w.id),selectedWalletId:r,from:i,to:a,nextToken:u}))},ft=i=>F(this,[i],function*({pageParam:a={from:l,to:o,nextToken:void 0}}){D.current++;const{transactions:u,nextToken:w,unsupportedChains:C}=yield y.Tl.emit(A.Z.FETCH_ASSETS_TRANSACTION_HISTORY,{from:a.from,to:a.to,nextToken:a.nextToken,blockchains:O});let j=a.from,M=a.to,I=w;if(u?.length&&N.h.dispatch(E.K.actions.updateTxs({items:u,walletId:r})),C?.length&&(rt(C),h?.length)){const z=d.filter(H=>!C.includes(H.id)).filter(H=>!h.includes(H.id));z.length>0&&dt(z)}return n||P(l.toISOString(),o.toISOString()),a.from>new Date(n)&&o<new Date(n)&&(P(l.toISOString(),e,x),j=(0,S.n9)(new Date(e),-m),M=new Date(e),I=void 0),(a.to<new Date(e)||new Date(e).getTime()===a.to.getTime()&&I!==x)&&P(n,o.toISOString(),I),G&&Z(!1),c(j),B(M),Q(!u?.length),ut(),{transactions:u,from:j,to:M,nextToken:I}}),{fetchNextPage:Y,hasNextPage:Tt,isFetchingNextPage:vt}=(0,et.N)(["transactions",r],ft,{refetchOnWindowFocus:!1,refetchOnReconnect:!1,staleTime:1e3*60*5,cacheTime:1e3*60*60*24,enabled:p,getNextPageParam:i=>{var a;if(!(o<=L.gs||i===null))return G?{from:l,to:o,nextToken:x}:i.nextToken||x?{nextToken:(a=i.nextToken)!=null?a:x,from:l,to:o}:{from:new Date(i.to.getTime()),to:(0,S.n9)(i.to,m)}}});return(0,s.useEffect)(()=>{K&&D.current>1&&o>L.gs&&Y(),Q(!1)},[K]),(0,s.useEffect)(()=>()=>{v.removeQueries(),ht(!1)},[]),{fetchNextPage:Y,hasNextPage:Tt,isFetchingNextPage:vt,isFirstFetch:D.current<2}}const at=()=>{(0,J.d)({event:b.pG.HISTORY,props:null});const{formatMessage:r}=(0,q.Z)(),n=(0,$.K)(),e=window.innerHeight-16-16-28-64,[h,T]=(0,s.useState)(!0),{fetchNextPage:d,hasNextPage:v,isFetchingNextPage:l,isFirstFetch:c}=it();return(0,s.useEffect)(()=>{(Object.keys(n).length||!c)&&T(!1)},[n]),(0,f.jsxs)(g._z,{children:[(0,f.jsx)(g.mr,{title:r({id:"history-list.title"})}),(0,f.jsx)(g.xV,{children:(0,f.jsx)(_.Z,{dataLength:Object.values(n).flat().length,next:d,height:e,className:"tw-scrollbar",hasMore:!!v,loader:null,style:{display:"flex",flexDirection:"column"},children:(0,f.jsx)(V.z,{transactions:n,scrollableAreaHeight:e,loadMoreItems:d,fetchingTransactions:l||h,hasNextPage:v,historyAvailable:!0})})})]})},R=(0,X.K)(()=>(0,f.jsx)(U.P,{messageFileId:"app_src_popup_modules_home_locales",children:(0,f.jsx)(at,{})})),lt=R}}]);
