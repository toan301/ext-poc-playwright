"use strict";(self.webpackChunkbrowser_extension_wallet=self.webpackChunkbrowser_extension_wallet||[]).push([[10],{63032:(Me,b,n)=>{n.r(b),n.d(b,{App:()=>Te,default:()=>ms});var e=n(85893),y=n(89250),K=n(75329),B=n(13920),P=n(64064),j=n(82911),C=n(13012),c=n(67294),E=n(86896),Y=Object.defineProperty,w=Object.defineProperties,z=Object.getOwnPropertyDescriptors,N=Object.getOwnPropertySymbols,Z=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable,D=(t,s,a)=>s in t?Y(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,X=(t,s)=>{for(var a in s||(s={}))Z.call(s,a)&&D(t,a,s[a]);if(N)for(var a of N(s))M.call(s,a)&&D(t,a,s[a]);return t},_=(t,s)=>w(t,z(s));const De=({value:t,min:s,max:a})=>{const r={number:!1,min:!1,max:!1};if(!t)return _(X({},r),{isValid:!1});try{const o=(0,C.Z)(t);r.number=!0,r.min=typeof s<"u"?o.gte((0,C.Z)(s)):!0,r.max=typeof a<"u"?o.lte((0,C.Z)(a)):!0}catch{}finally{return _(X({},r),{isValid:Object.values(r).every(o=>!!o)})}},Ie=({value:t,min:s,max:a})=>{const{formatMessage:r}=(0,E.Z)(),[o,m]=(0,c.useState)({isValid:!1,number:!1,min:!1,max:!1});(0,c.useEffect)(()=>{m(X({},De({value:t,min:s,max:a})))},[t,s,a]);const u=(0,c.useMemo)(()=>{if(!o.number)return r({id:"validate-amount.generic"});if(!o.min)return r({id:"validate-amount.min"},{number:s});if(!o.max)return r({id:"validate-amount.max"},{number:a})},[r,o,s]);return{isValid:o.isValid,error:u}};var Ve=n(23279),Re=n.n(Ve),ee=n(24044),se=n(74301),Le=n(3538),W=n(59078),Ue=Object.defineProperty,be=Object.defineProperties,Be=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,we=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable,ae=(t,s,a)=>s in t?Ue(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,ne=(t,s)=>{for(var a in s||(s={}))we.call(s,a)&&ae(t,a,s[a]);if(te)for(var a of te(s))Ze.call(s,a)&&ae(t,a,s[a]);return t},le=(t,s)=>be(t,Be(s)),re=(t,s,a)=>new Promise((r,o)=>{var m=l=>{try{i(a.next(l))}catch(v){o(v)}},u=l=>{try{i(a.throw(l))}catch(v){o(v)}},i=l=>l.done?r(l.value):Promise.resolve(l.value).then(m,u);i((a=a.apply(t,s)).next())});const oe=t=>re(void 0,[t],function*({value:s,blockchain:a,blockchainType:r,isAddingTokenManually:o}){try{const m=yield(0,Le.G)({address:s,blockchain:a,blockchainType:r}),u=yield W.Tl.emit(ee.Z.VALIDATE_ASSET,m);return{asset:m,isValid:u.global,intlErrorParams:u.global?null:[{id:"input-contract-address.validation.metadata"},{a:i=>(0,e.jsx)("a",{href:"https://support.trustwallet.com/support/home",target:"_blank",rel:"noopener nofollow noreferrer",children:i})}]}}catch{return o?{asset:null,isValid:yield W.Tl.emit(se.Z.VALIDATE_CONTRACT_ADDRESS_FORMAT,{address:s,network:a}),intlErrorParams:[{id:"input-contract-address.validation.manual.wrong-address"},{}]}:{asset:null,isValid:!1,intlErrorParams:[{id:"input-contract-address.validation.not-found"},{networkName:a.name}]}}}),We=({value:t,blockchain:s,blockchainType:a,isAddingTokenManually:r})=>{const{formatMessage:o}=(0,E.Z)(),[m,u]=(0,c.useState)({isValid:!1,isLoading:!1,asset:null}),i=(0,c.useRef)(!1),l=(0,c.useCallback)(Re()(v=>re(void 0,[v],function*({blockchain:V,value:d}){i.current=!1;let h={isValid:!1,asset:null};d&&(h=yield oe({value:d,blockchain:V,blockchainType:a,isAddingTokenManually:r})),!i.current&&u(le(ne({},h),{error:h.isValid||!h.intlErrorParams?void 0:o(...h.intlErrorParams),isLoading:!1}))}),200),[oe,o]);return(0,c.useEffect)(()=>(u(v=>le(ne({},v),{isLoading:!0})),l({blockchain:s,value:t}),()=>{l.cancel(),i.current=!0}),[l,s,t]),m};var ie=n(84600),de=n(19096),ce=n(37632),me=n(49756),ke=n(63118),$e=n(62067),H=n(99244),k=n(83522),Fe=n(42437),S=n(48161),ue=n(32193),Ge=n(59995),A=n(48303),f=n(45618),Ke=n(34601),I=n(44180),ve=n(87326),xe=n(12505),pe=n(28200);class Ye extends Error{constructor(s){super(s),this.name="NetworkError"}}var ze=n(44645),Xe=n(77985),he=n(83954),He=n(83963);const Je=({asset:t,blockchain:s})=>{const{formatMessage:a}=(0,E.Z)();return(0,e.jsx)(he.Z,{theme:He.x.TRANSPARENT,children:(0,e.jsxs)("div",{className:"flex justify-between space-x-2 items-center",children:[(0,e.jsx)("div",{children:(0,e.jsx)(H.C,{name:t.name,network:s,src:t.iconUrl})}),(0,e.jsxs)("div",{className:"flex-grow",children:[(0,e.jsxs)("div",{className:"flex flex-row space-x-1",children:[(0,e.jsx)("div",{children:(0,e.jsx)(A.x,{type:f.Xi.TITLE,children:t.name})}),(0,e.jsx)("div",{children:t.type&&(0,e.jsx)(Xe.C,{text:t.type})})]}),(0,e.jsx)("div",{className:"flex flex-row space-x-1",children:(0,e.jsx)(A.x,{type:f.Xi.CAPTION,theme:f.W5.SECONDARY,children:s.name})})]}),(0,e.jsxs)("div",{className:"text-right",children:[(0,e.jsx)("div",{children:(0,e.jsx)(A.x,{type:f.Xi.TITLE,children:a({id:"input-contract-address.symbol"},{symbol:t.symbol})})}),(0,e.jsx)("div",{children:(0,e.jsx)(A.x,{type:f.Xi.CAPTION,children:a({id:"input-contract-address.decimals"},{decimals:t.decimals})})})]})]})})};var Qe=n(36492),fe=n(94061),g=n(70473),qe=n(44525),je=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,es=Object.prototype.propertyIsEnumerable,ss=(t,s)=>{var a={};for(var r in t)_e.call(t,r)&&s.indexOf(r)<0&&(a[r]=t[r]);if(t!=null&&je)for(var r of je(t))s.indexOf(r)<0&&es.call(t,r)&&(a[r]=t[r]);return a},ye=(t,s,a)=>new Promise((r,o)=>{var m=l=>{try{i(a.next(l))}catch(v){o(v)}},u=l=>{try{i(a.throw(l))}catch(v){o(v)}},i=l=>l.done?r(l.value):Promise.resolve(l.value).then(m,u);i((a=a.apply(t,s)).next())});const ts=()=>{const{blockchainId:t,blockchainType:s,contractAddress:a}=(0,y.UO)(),{trackAnalytics:r}=(0,qe.z)();if(!t)throw new Error("Blockchain id is invalid.");if(!s)throw new Error("Blockchain type is invalid.");const o=(0,ve.R)(),m=(0,pe.O)(),u=(0,xe.$)(),i=(0,c.useMemo)(()=>(0,K.Sb)(t,s===I.F.TEST,s===I.F.CUSTOM,o,u,m),[t,s,o,u,m]);if(!i)throw new Error(`Could not find network with blockchain ID "${t}".`);const{formatMessage:l}=(0,E.Z)(),v=(0,y.s0)(),[V,d]=(0,c.useState)(!1),[h,us]=(0,c.useState)(a??""),[Ee,Q]=(0,c.useState)(""),[$,vs]=(0,c.useState)(""),[F,xs]=(0,c.useState)(""),[G,ps]=(0,c.useState)(""),[O,hs]=(0,c.useState)(),p=location.href.includes("manual");(0,fe.d)({event:p?g.pG.CUSTOM_ASSET_ADD_ASSET_MANUALLY:g.pG.CUSTOM_ASSET_ADD_ASSET,props:null});const{data:Se}=(0,Qe.a)(["tokens-map"],()=>W.Tl.emit(se.Z.FETCH_TOKEN_TYPES)),R=(0,c.useMemo)(()=>new Map(Object.entries(Se||[]).filter(([x,T])=>!0)),[Se]).get(t),Oe=We({value:h,blockchain:i,blockchainType:s,isAddingTokenManually:p}),{asset:L}=Oe,U=ss(Oe,["asset"]),Pe=(0,ie.J)({value:$}),ge=(0,ie.J)({value:F}),Ce=Ie({value:G,min:0,max:32}),fs=p?U.isValid&&Pe.isValid&&ge.isValid&&Ce.isValid&&(R?!!O:!0):U.isValid,q=(0,c.useMemo)(()=>{if(p)return{name:$,symbol:F,decimals:parseInt(G),blockchainId:i.id,address:h,balance:"0",isShownInHomeScreen:!0,isUserCustomAsset:!0,assetId:(0,Ke.TN)({coinId:i.coinId,address:h})||"",type:O?.id}},[p,$,F,G,i,h,O?.id]),js=(0,c.useCallback)(x=>ye(void 0,null,function*(){if(x.preventDefault(),!(!L&&!q)){d(!0),Q("");try{const T=p?q:L;yield W.Tl.emit(ee.Z.ADD_ASSET,{asset:T,blockchainType:s}),r({event:g.ih.ADD_CUSTOM_ASSET,props:{pageViewSource:p?g.pG.CUSTOM_ASSET_ADD_ASSET_MANUALLY:g.pG.CUSTOM_ASSET_ADD_ASSET,assetName:T.name,assetId:T.assetId,blockchainId:T.blockchainId}}),v(j.Z.DEFAULT)}catch(T){Q(T.name===Ye.name?"generic.network-error":"add-asset.register-error")}finally{d(!1)}}}),[L,s,p,q,v,r]),ys=()=>ye(void 0,null,function*(){yield(0,ze.YQ)(`${j.Z.CUSTOM_ASSET_ADD_ASSET}/${s}/${i.id}/manual/${h}`)}),As=x=>{Q(""),us(x.target.value.trim())};return(0,e.jsxs)(S._z,{children:[!p&&(0,e.jsx)(S.mr,{backAction:()=>v(-1),title:l({id:"add-custom-asset.title"})}),(0,e.jsxs)(S.xV,{children:[p&&(0,e.jsx)("div",{className:"flex my-11 justify-center",children:(0,e.jsx)(B.Y,{})}),(0,e.jsxs)("div",{className:`flex h-full flex-col flex-1 ${p?"bg-backgroundPrimary border border-line rounded p-6":""}`,children:[p&&(0,e.jsx)("div",{className:"text-center",children:(0,e.jsx)(A.x,{type:f.Xi.HEADLINE,children:l({id:"add-custom-asset.title"})})}),(0,e.jsxs)("div",{className:"flex flex-col items-center space-y-1 pt-2",children:[(0,e.jsx)(H.C,{name:i.name,src:i.iconUrl,size:ue.m.LARGE}),(0,e.jsx)(A.x,{theme:f.W5.SECONDARY,weight:f.kx.NORMAL,children:l({id:"generic.on-network"},{networkName:i.displayName||i.name})})]}),(0,e.jsxs)("div",{className:"flex flex-col space-y-6 mt-6",children:[(0,e.jsx)("div",{children:(0,e.jsx)(k.o,{testid:"custom-asset-address-input",value:h,onChange:As,validation:U,placeholder:l({id:"input-contract-address.label"}),autoFocus:!0})}),p&&(0,e.jsxs)(e.Fragment,{children:[!!R&&(0,e.jsx)(Ge.P,{testid:"custom-asset-type-select",label:l({id:"custom-asset.token-type"}),selected:O??{id:Object.entries(R)[0][0],name:Object.entries(R)[0][1].name},setSelected:x=>hs(x),options:Object.entries(R).map(([x,T])=>{var Ne;return{id:x,name:(Ne=T.name)!=null?Ne:x}})}),(0,e.jsx)("div",{children:(0,e.jsx)(k.o,{testid:"custom-asset-name-input",value:$,onChange:x=>vs(x.target.value),label:l({id:"custom-asset.token-name"}),validation:Pe})}),(0,e.jsx)("div",{children:(0,e.jsx)(k.o,{testid:"custom-asset-symbol-input",value:F,onChange:x=>xs(x.target.value),label:l({id:"custom-asset.token-symbol"}),validation:ge})}),(0,e.jsx)("div",{children:(0,e.jsx)(k.o,{testid:"custom-asset-decimals-input",value:G,type:Fe.rC.NUMBER,onChange:x=>ps(x.target.value),label:l({id:"custom-asset.token-decimals"}),validation:Ce})})]}),!p&&U.isValid&&L&&(0,e.jsxs)("div",{className:"flex flex-col items-center",children:[(0,e.jsx)("div",{className:"pb-4",children:(0,e.jsx)($e.v,{colorClass:"text-iconNormal"})}),(0,e.jsx)("div",{className:"pb-2",children:(0,e.jsx)(A.x,{weight:f.kx.NORMAL,children:l({id:"input-contract-address.confirmation"})})}),(0,e.jsx)("div",{className:"w-full",children:(0,e.jsx)(Je,{asset:L,blockchain:i})})]})]}),(0,e.jsxs)("div",{className:"flex justify-end flex-1 flex-col space-y-4 pt-6",children:[(0,e.jsx)(de.b,{theme:ce.q.WARNING,children:l({id:"add-asset.warning"},{b:x=>(0,e.jsx)("span",{className:"font-medium",children:x})})}),Ee&&(0,e.jsx)(de.b,{theme:ce.q.DANGER,children:l({id:Ee})}),!p&&h&&(0,e.jsx)(me.z,{testid:"custom-asset-add-token-manually-button",theme:ke.jM.NEUTRAL,onClick:ys,children:l({id:"add-asset.btn-add-token-manually"})}),(0,e.jsx)(me.z,{testid:"custom-asset-add-token-button",onClick:js,disabled:!fs,loading:V||U.isLoading,children:l({id:"add-asset.btn-add-asset"})})]})]})]})]})},Ae=()=>(0,e.jsx)(P.P,{messageFileId:"app_src_popup_modules_home_locales",children:(0,e.jsx)(ts,{})});var as=n(17889),ns=n(48407),ls=n(1942);const J=({name:t,iconUrl:s,onClick:a})=>(0,e.jsx)(he.Z,{noPadding:!0,children:(0,e.jsx)(ls.e,{onClick:a,children:(0,e.jsx)("div",{className:"flex items-center justify-between py-2.5 px-4",children:(0,e.jsxs)("div",{className:"flex items-center space-x-2 ",children:[(0,e.jsx)(H.C,{name:t,src:s,size:ue.m.LARGE,abstractFallback:!0}),(0,e.jsx)(A.x,{type:f.Xi.TITLE,theme:f.W5.PRIMARY,children:t})]})})})});var rs=n(66696),os=n(91214);const is=()=>{const t=(0,y.s0)(),{formatMessage:s}=(0,E.Z)(),a=(0,as.Z)(),{isTest:r}=(0,os.p)(),o=(0,ve.R)(!0),m=(0,pe.O)(!0),u=(0,xe.$)(!0),i=(0,rs.x)()[a.id],l=(0,c.useCallback)(d=>!!i[d],[i]),v=(0,c.useMemo)(()=>o.filter(d=>(a.type!==ns.S.HARDWARE||l(d.coinId))&&d.customTokensEnabled),[o,a.type,l]),V=(0,c.useMemo)(()=>m.filter(({customTokensEnabled:d})=>!!d),[m]);return(0,e.jsxs)("div",{className:"space-y-4",children:[!r&&v.map(d=>(0,e.jsx)(J,{name:d.name,iconUrl:d.iconUrl,onClick:()=>t(`${j.Z.CUSTOM_ASSET_ADD_ASSET}/${I.F.MAIN}/${d.id}`)},d.id)),u.map(d=>(0,e.jsx)(J,{name:d.name,iconUrl:d.iconUrl,onClick:()=>t(`${j.Z.CUSTOM_ASSET_ADD_ASSET}/${I.F.CUSTOM}/${d.id}`)},d.id)),(0,e.jsx)("div",{className:"mb-4",children:(0,e.jsx)(A.x,{type:f.Xi.TITLE,children:s({id:"network.test.title"})})}),V.map(d=>(0,e.jsx)(J,{name:d.name,iconUrl:d.iconUrl,onClick:()=>t(`${j.Z.CUSTOM_ASSET_ADD_ASSET}/${I.F.TEST}/${d.id}`)},d.id))]})},ds=()=>{(0,fe.d)({event:g.pG.CUSTOM_ASSET_SELECT_NETWORK,props:null});const{formatMessage:t}=(0,E.Z)(),s=(0,y.s0)(),a=(0,c.useCallback)(()=>{s(j.Z.MANAGE_CRYPTO)},[s]);return(0,e.jsxs)(S._z,{children:[(0,e.jsx)(S.mr,{backAction:a,title:t({id:"network.header"})}),(0,e.jsx)(S.xV,{children:(0,e.jsx)(S.Wo,{children:(0,e.jsx)(is,{})})})]})},cs=()=>(0,e.jsx)(P.P,{messageFileId:"app_src_popup_modules_home_locales",children:(0,e.jsx)(ds,{})}),Te=()=>(0,e.jsxs)(y.Z5,{children:[(0,e.jsx)(y.AW,{path:"/select-network",element:(0,e.jsx)(cs,{})}),(0,e.jsx)(y.AW,{path:"/add-asset/:blockchainType/:blockchainId",element:(0,e.jsx)(Ae,{})}),(0,e.jsx)(y.AW,{path:"/add-asset/:blockchainType/:blockchainId/manual/:contractAddress?",element:(0,e.jsx)(Ae,{})})]}),ms=Te},59995:(Me,b,n)=>{n.d(b,{P:()=>E});var e=n(85893),y=n(88813),K=n(73748),B=n(48303),P=n(45618),j=n(75498),C=n(47031),c=n(67294);const E=({options:Y,selected:w,setSelected:z,label:N,testid:Z})=>(0,e.jsxs)("div",{className:"w-full",children:[N&&(0,e.jsx)(B.x,{children:N}),(0,e.jsx)(j.R,{value:w,by:"id",onChange:z,children:(0,e.jsxs)("div",{className:"relative w-full mt-1",children:[(0,e.jsxs)(j.R.Button,{"data-testid":Z,className:"relative w-full cursor-default input-field title-text font-medium h-12",children:[(0,e.jsx)("span",{className:"block truncate",children:w.name}),(0,e.jsx)("span",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2",children:(0,e.jsx)(K.v,{colorClass:"text-iconNormal"})})]}),(0,e.jsx)(C.u,{as:c.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,e.jsx)(j.R.Options,{className:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded bg-bg3 py-1 shadow-lg focus:outline-none",children:Y.map(M=>(0,e.jsx)(j.R.Option,{"data-testid":`${Z}-option`,className:"relative cursor-default select-none px-4 py-2",value:M,children:({selected:D})=>(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("div",{className:"flex flex-1",children:(0,e.jsx)(B.x,{type:P.Xi.TITLE,theme:D?P.W5.BRAND:P.W5.PRIMARY,truncated:!0,children:M.name})}),D&&(0,e.jsx)("div",{children:(0,e.jsx)(y.n,{colorClass:"text-primary"})})]})},M.id))})})]})})]})}}]);
